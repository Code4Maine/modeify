#!/usr/bin/env node

// Test whatever

var processEmails = require('../lib/email/process');
var log = require('../lib/log');

processEmails(function(err, batch) {
  if (err) {
    log.error(err);
    process.exit(1);
  } else {
    log.info('processing ' + batch.fns.length + ' emails');
    batch.on('progress', function(e) {
      log.info('batch processing progress', e);
    });
    batch.end(function(err, results) {
      if (err) {
        log.error(err);
        process.exit(1);
      } else {
        log.info('completed');
        process.exit(0);
      }
    });
  }
});
